<split-panel-container>
    <h1>Test / Acceptance Criteria</h1>

    <div>
        <div class="panel-body">
            <form #stepForm="ngForm" class="form-horizontal">

                <div class="form-group row">
                    <label class="col-md-1 control-label">Path</label>
                    <div class="col-md-11 form-value">
                        {{getPathWithoutTestName()}}
                    </div>
                </div>


                <div class="form-group row">
                    <label class="col-md-1 control-label col-form-label" for="testName">Name</label>

                    <div class="col-md-11 form-value" *ngIf="!isEditMode">
                        {{testModel.text || ""}}
                    </div>
                    <div class="col-md-10" *ngIf="isEditMode">
                        <input id="testName" required
                               #testName="ngModel" [(ngModel)]="testModel.text"
                               type="text" class="form-control" name="testName">
                        <div *ngIf="testName.errors && (testName.dirty || testName.touched)"
                             class="alert alert-danger">
                            <div [hidden]="!testName.errors.required">
                                Name is required
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TEST TYPE & DISABLED -->
                <div class="form-group row">
                    <label class="col-md-1 control-label" for="testTypeSwitch">Type</label>
                    <div class="col-md-11 form-value type-and-disabled-values">
                        <div *ngIf="!isEditMode" class="type-container">
                            <span *ngIf="!testModel.properties.isManual" class="label label-success">Automated</span>
                            <span *ngIf="testModel.properties.isManual" class="label label-warning">Manual</span>
                        </div>
                        <div *ngIf="isEditMode" class="type-container">

                            <p-toggleButton onLabel="Manual" offLabel="Automated"
                                            onIcon="fa fa_my-manual-test" offIcon="fa fa_my-automated-test" [(ngModel)]="testModel.properties.isManual"
                                            styleClass="toggle-test-type"
                                            name="testTypeSwitch" id="testTypeSwitch"></p-toggleButton>
                        </div>

                        <div class="disabled-container">
                            <div *ngIf="!isEditMode">
                                <span *ngIf="testModel.properties.isDisabled" class="label label-danger">Disabled</span>
                            </div>
                            <div *ngIf="isEditMode">

                                <p-toggleButton onLabel="Disabled" offLabel="Enabled"
                                                onIcon="fa fa-times" offIcon="fa fa-check" [(ngModel)]="testModel.properties.isDisabled"
                                                styleClass="toggle-test-state"
                                                name="testStateSwitch" id="testStateSwitch"></p-toggleButton>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAGS -->
                <div class="form-group row" *ngIf="!isEditMode && testModel.tags.length > 0 ">
                    <label class="col-md-1 control-label" for="tags">Tags</label>
                    <div class="col-md-11 form-value" *ngIf="!isEditMode">
                        <ng-container *ngFor="let tag of testModel.tags">
                            <span class="label label-primary">{{tag}}</span>
                        </ng-container>
                    </div>
                </div>
                <div class="form-group row" *ngIf="isEditMode">
                    <label class="col-md-1 control-label" for="tags">Tags</label>
                    <div class="col-md-11">
                        <p-autoComplete #tagsElement
                                        [(ngModel)]="testModel.tags"
                                        [suggestions]="tagsToShow"
                                        (completeMethod)="onSearchTag($event)"
                                        (onSelect)="onTagSelect($event)"
                                        (keypress)="onTagsKeyUp($event);"
                                        [delay]="0"
                                        [multiple]="true"
                                        [dropdown]="true"
                                        id="tags" name="tags"></p-autoComplete>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-md-1 control-label" for="description">Description</label>
                    <div class="col-md-11 form-value" *ngIf="!isEditMode">
                        {{testModel.description || ""}}
                    </div>
                    <div class="col-md-10" *ngIf="isEditMode">
                        <textarea [(ngModel)]="testModel.description" class="form-control" id="description"
                                  name="description"></textarea>
                    </div>
                </div>

                <p-messages *ngIf="warnings.length > 0" [(value)]="warnings" styleClass="error-message"></p-messages>

                <div>
                    <h4 class="inline"><strong>Steps</strong></h4>

                    <!-- BUTTONS -->
                    <div class="step-action-panel inline btn-group">

                        <div *ngIf="!isEditMode"
                             title="Run Tests" class="btn btn-default btn-xs btn-group"
                             (click)="runTest(); $event.stopPropagation()">
                            <span class="glyphicon glyphicon-play"></span>
                        </div>

                        <div title="Add Step" class="btn btn-default btn-xs btn-group"
                             *ngIf="isEditMode"
                             (click)="addStep(); $event.stopPropagation()">
                            <i class="fa fa-plus" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>

                <step-call-tree [stepCalls]="testModel.stepCalls"></step-call-tree>

                <div class="panel-footer-button">
                    <ng-container *ngIf="!isEditMode">
                        <button (click)="enableEditTestMode();" class="btn btn-primary">Edit</button>
                    </ng-container>
                    <ng-container *ngIf="isEditMode">
                        <button (click)="cancelAction();" type="button" class="btn btn-default">Cancel</button>
                        <button *ngIf="!isCreateAction" (click)="deleteAction();;$event.stopPropagation();" type="button" class="btn btn-danger">Delete</button>
                        <button [disabled]="!stepForm.form.valid" (click)="saveAction();$event.stopPropagation();" class="btn btn-primary">Save</button>
                    </ng-container>

                </div>
            </form>
        </div>
    </div>

</split-panel-container>
